{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://modelconvert.station/schema/task_schema.json",
  "title": "ModelConvert-Station Task Schema",
  "description": "Schema for defining model conversion tasks in ModelConvert-Station",
  "type": "object",
  "required": ["tasks"],
  "properties": {
    "tasks": {
      "type": "array",
      "description": "List of conversion tasks to execute",
      "minItems": 1,
      "maxItems": 100,
      "items": {
        "$ref": "#/definitions/conversionTask"
      }
    },
    "global_config": {
      "type": "object",
      "description": "Global configuration applied to all tasks",
      "properties": {
        "opset_version": {
          "type": "integer",
          "description": "ONNX opset version to use",
          "minimum": 7,
          "maximum": 21,
          "default": 17
        },
        "optimization_level": {
          "type": "integer",
          "description": "Level of optimization to apply",
          "minimum": 0,
          "maximum": 3,
          "default": 2
        },
        "generate_java_template": {
          "type": "boolean",
          "description": "Whether to generate Java inference templates",
          "default": true
        }
      }
    }
  },
  "definitions": {
    "conversionTask": {
      "type": "object",
      "required": ["source_url"],
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this task (auto-generated if not provided)",
          "pattern": "^[a-zA-Z0-9_-]+$",
          "minLength": 1,
          "maxLength": 64
        },
        "source_url": {
          "type": "string",
          "description": "URL to download the model from (HTTP/HTTPS/Google Drive)",
          "format": "uri",
          "minLength": 10,
          "maxLength": 2048
        },
        "source_framework": {
          "type": "string",
          "description": "Source framework (auto-detected if not specified)",
          "enum": ["pytorch", "tensorflow", "keras", "tflite", "mediapipe", "onnx"]
        },
        "target_format": {
          "type": "string",
          "description": "Target conversion format",
          "enum": ["onnx"],
          "default": "onnx"
        },
        "optimization_level": {
          "type": "integer",
          "description": "Optimization level for this specific task (overrides global)",
          "minimum": 0,
          "maximum": 3,
          "default": 2
        },
        "generate_java_template": {
          "type": "boolean",
          "description": "Generate Java inference template for this task",
          "default": true
        },
        "custom_args": {
          "type": "object",
          "description": "Framework-specific custom arguments",
          "additionalProperties": true,
          "properties": {
            "input_shape": {
              "type": "array",
              "description": "Input tensor shape [batch, channels, height, width]",
              "items": {
                "type": "integer",
                "minimum": 1
              },
              "minItems": 1,
              "maxItems": 5
            },
            "input_shapes": {
              "type": "array",
              "description": "Multiple input tensor shapes for multi-input models like LOFTR",
              "items": {
                "type": "array",
                "items": {
                  "type": "integer",
                  "minimum": 1
                },
                "minItems": 1,
                "maxItems": 5
              },
              "minItems": 1,
              "maxItems": 10
            },
            "input_names": {
              "type": "array",
              "description": "Names of input tensors",
              "items": {
                "type": "string"
              }
            },
            "output_names": {
              "type": "array",
              "description": "Names of output tensors",
              "items": {
                "type": "string"
              }
            },
            "opset_version": {
              "type": "integer",
              "description": "ONNX opset version",
              "minimum": 7,
              "maximum": 21
            },
            "dynamic_axes": {
              "type": "object",
              "description": "Dynamic axes configuration for PyTorch models",
              "additionalProperties": {
                "type": "object",
                "patternProperties": {
                  "^[0-9]+$": {
                    "type": "string"
                  }
                }
              }
            },
            "do_constant_folding": {
              "type": "boolean",
              "description": "Enable constant folding during PyTorch export",
              "default": true
            },
            "inputs_as_nchw": {
              "type": "array",
              "description": "Input names to convert from NHWC to NCHW (TensorFlow)",
              "items": {
                "type": "string"
              }
            },
            "outputs_as_nchw": {
              "type": "array",
              "description": "Output names to convert from NHWC to NCHW (TensorFlow)",
              "items": {
                "type": "string"
              }
            },
            "dequantize": {
              "type": "boolean",
              "description": "Dequantize quantized TFLite models",
              "default": true
            },
            "keep_channel_last": {
              "type": "boolean",
              "description": "Keep NHWC format for TFLite models",
              "default": false
            },
            "convert_all_models": {
              "type": "boolean",
              "description": "Convert all sub-models in MediaPipe tasks",
              "default": true
            },
            "large_model": {
              "type": "boolean",
              "description": "Use external data format for large TensorFlow models",
              "default": false
            }
          }
        },
        "tags": {
          "type": "array",
          "description": "Optional tags for organizing tasks",
          "items": {
            "type": "string",
            "maxLength": 32
          },
          "maxItems": 10
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of this task",
          "maxLength": 500
        }
      }
    }
  },
  "examples": [
    {
      "tasks": [
        {
          "id": "resnet50_pytorch",
          "source_url": "https://example.com/models/resnet50.pth",
          "source_framework": "pytorch",
          "optimization_level": 2,
          "custom_args": {
            "input_shape": [1, 3, 224, 224],
            "input_names": ["input"],
            "output_names": ["output"]
          },
          "description": "Convert ResNet50 from PyTorch Hub"
        }
      ]
    }
  ]
}
